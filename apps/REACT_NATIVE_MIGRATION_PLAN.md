# React Native 0.76 Migration Plan

**Created**: 2025-10-26
**Status**: Ready for execution
**Goal**: Migrate from broken RN 0.73 project to fresh RN 0.76 setup

---

## Executive Summary

### Current State

- **mobile-old** (RN 0.73): Missing iOS `project.pbxproj` file, but has all working source code (73 TypeScript files)
- **mobile** (RN 0.76): Has native structure but incomplete source code migration, pnpm/CocoaPods issues

### Recommendation

**Create a completely fresh React Native 0.76 project** using React Native CLI, then migrate the proven source code from `mobile-old`.

**Why fresh instead of fixing?**

1. Missing iOS project file in mobile-old is difficult to regenerate correctly
2. mobile (0.76) has pnpm symlink issues that are systemic
3. Fresh project ensures RN 0.76 best practices and new architecture support
4. Clean slate prevents carrying over configuration cruft

---

## Part 1: Assessment - What to Preserve vs Recreate

### ‚úÖ PRESERVE (Copy from mobile-old)

#### Source Code - 100% Reusable

```
mobile-old/src/
‚îú‚îÄ‚îÄ api/                  # API client layer (auth.ts, client.ts, streaks.ts, taskService.ts)
‚îú‚îÄ‚îÄ components/           # 16 components including BadgeCard, ErrorBoundary, PhotoPicker
‚îú‚îÄ‚îÄ constants/            # Theme, colors, accessibility
‚îú‚îÄ‚îÄ config/               # App configuration with env var handling
‚îú‚îÄ‚îÄ hooks/                # useAuth.ts, useOnboarding.ts
‚îú‚îÄ‚îÄ navigation/           # RootNavigator, DeepLinkHandler
‚îú‚îÄ‚îÄ screens/              # All onboarding + main app screens
‚îÇ   ‚îú‚îÄ‚îÄ onboarding/      # 8 onboarding screens
‚îÇ   ‚îú‚îÄ‚îÄ today/           # TodayScreen, TaskDetailModal
‚îÇ   ‚îî‚îÄ‚îÄ BadgesScreen.tsx
‚îú‚îÄ‚îÄ services/             # Business logic services
‚îú‚îÄ‚îÄ stores/               # Zustand stores (authStore, todayStore, streaksStore, etc.)
‚îú‚îÄ‚îÄ types/                # TypeScript type definitions
‚îî‚îÄ‚îÄ utils/                # Utilities (secureStorage, permissions, logger)
```

**Critical Features to Preserve:**

- ‚úÖ **Non-blocking auth hydration** (lines 64-79 in RootNavigator)
- ‚úÖ **5-second auth timeout** (lines 195-197 in authStore)
- ‚úÖ Deep linking configuration
- ‚úÖ Zustand store persistence with AsyncStorage
- ‚úÖ API client with token management
- ‚úÖ Comprehensive error handling

#### Configuration Files - Adapt with Updates

```
‚úÖ .env.example          # Environment variables template
‚úÖ babel.config.js       # Path aliases + reanimated plugin (from mobile)
‚úÖ tsconfig.json         # TypeScript configuration
‚úÖ jest.config.js        # Test configuration
‚úÖ .eslintrc.js          # Linting rules
‚úÖ .prettierrc           # Code formatting
```

### ‚ùå RECREATE (Generate Fresh)

#### Native Projects

```
‚ùå ios/                  # Will be generated by RN CLI
‚ùå android/              # Will be generated by RN CLI
```

**Reason**: Missing project.pbxproj file and potential build configuration issues.

#### Build Configuration

```
‚ùå package.json          # Will be generated, then dependencies added
‚ùå metro.config.js       # RN 0.76 has new defaults
‚ùå app.json              # Will be generated by init
```

#### Dependencies to Update

All dependencies will be reinstalled at RN 0.76 compatible versions:

| Package                                   | Old (0.73) | New (0.76) | Notes               |
| ----------------------------------------- | ---------- | ---------- | ------------------- |
| react                                     | 18.2.0     | 18.3.1     | Minor update        |
| react-native                              | 0.73.2     | 0.76.9     | Major update        |
| @react-navigation/native                  | ^6.1.9     | ^7.1.18    | Major update        |
| react-native-reanimated                   | ^4.1.2     | ~3.16.7    | Need v3 for RN 0.76 |
| @react-native-async-storage/async-storage | ^1.21.0    | ^2.2.0     | Major update        |

---

## Part 2: Fresh Project Setup Strategy

### Option Analysis: React Native CLI vs Expo

#### React Native CLI ‚úÖ RECOMMENDED

**Pros:**

- Full control over native code
- Better for monorepo with pnpm
- No Expo SDK overhead
- Matches current architecture
- Can eject to bare workflow later if needed

**Cons:**

- More complex setup
- Manual native module configuration

#### Expo (Bare Workflow)

**Pros:**

- Easier setup and updates
- Built-in dev tools
- Better over-the-air updates

**Cons:**

- pnpm support is hit-or-miss
- Adds SDK layer complexity
- Team already familiar with RN CLI

**Decision**: Use **React Native CLI** for consistency with existing approach.

---

## Part 3: Step-by-Step Migration Plan

### Phase 1: Create Fresh RN 0.76 Project

```bash
# Navigate to apps directory
cd /Users/devarisbrown/Code/projects/gtsd/apps

# Rename existing broken projects (backup)
mv mobile mobile-broken-0.76-backup
mv mobile-old mobile-old-0.73-backup

# Create fresh React Native 0.76 project
npx @react-native-community/cli@latest init mobile --version 0.76.9

# Answer prompts:
# - Skip CocoaPods install? NO (let it install)
# - Template: default
```

### Phase 2: Configure for Monorepo + pnpm

```bash
cd mobile

# Remove node_modules and package-lock.json (we'll use pnpm)
rm -rf node_modules package-lock.json

# Update package.json name to match workspace
# Change: "name": "mobile"
# To: "name": "@gtsd/mobile"
```

**Edit `mobile/package.json`:**

```json
{
  "name": "@gtsd/mobile",
  "version": "1.0.0",
  "private": true
  // ... rest of generated config
}
```

**Install with pnpm:**

```bash
# From monorepo root
cd /Users/devarisbrown/Code/projects/gtsd

# Install all dependencies
pnpm install

# Install iOS pods (from mobile directory)
cd apps/mobile/ios
pod install
cd ../../..
```

### Phase 3: Add Required Dependencies

```bash
cd /Users/devarisbrown/Code/projects/gtsd/apps/mobile

# Core navigation
pnpm add @react-navigation/native @react-navigation/native-stack @react-navigation/stack
pnpm add react-native-screens react-native-safe-area-context react-native-gesture-handler

# State management
pnpm add zustand immer
pnpm add @react-native-async-storage/async-storage

# Forms and validation
pnpm add react-hook-form @hookform/resolvers zod

# API client
pnpm add axios @tanstack/react-query

# Native modules
pnpm add react-native-config
pnpm add react-native-keychain
pnpm add @react-native-community/netinfo
pnpm add react-native-haptic-feedback
pnpm add react-native-date-picker
pnpm add @react-native-picker/picker
pnpm add react-native-image-picker

# Animations (v3 for RN 0.76)
pnpm add react-native-reanimated@~3.16.7

# Workspace dependency
pnpm add @gtsd/shared-types@workspace:*

# Dev dependencies
pnpm add -D @babel/core @babel/preset-env @babel/runtime
pnpm add -D @babel/plugin-transform-export-namespace-from
pnpm add -D babel-plugin-module-resolver
pnpm add -D @testing-library/react-native @testing-library/jest-native
pnpm add -D @types/jest @types/react @types/react-test-renderer
pnpm add -D eslint-config-prettier prettier
```

### Phase 4: Configure Build Tools

#### 4.1 Update `babel.config.js`

```javascript
module.exports = {
  presets: ['module:@react-native/babel-preset'],
  plugins: [
    [
      'module-resolver',
      {
        root: ['./'],
        extensions: ['.ios.js', '.android.js', '.js', '.ts', '.tsx', '.json'],
        alias: {
          '@': './src',
          '@components': './src/components',
          '@screens': './src/screens',
          '@navigation': './src/navigation',
          '@store': './src/store',
          '@stores': './src/stores',
          '@utils': './src/utils',
          '@constants': './src/constants',
          '@types': './src/types',
          '@hooks': './src/hooks',
          '@api': './src/api',
        },
      },
    ],
    // Required for zod v4 export syntax
    '@babel/plugin-transform-export-namespace-from',
    // ‚ö†Ô∏è CRITICAL: Reanimated plugin must be LAST
    'react-native-reanimated/plugin',
  ],
};
```

#### 4.2 Update `tsconfig.json`

```json
{
  "extends": "@react-native/typescript-config/tsconfig.json",
  "compilerOptions": {
    "target": "esnext",
    "module": "commonjs",
    "lib": ["esnext"],
    "jsx": "react-native",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "allowSyntheticDefaultImports": true,
    "baseUrl": "./",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@screens/*": ["src/screens/*"],
      "@navigation/*": ["src/navigation/*"],
      "@store/*": ["src/store/*"],
      "@stores/*": ["src/stores/*"],
      "@utils/*": ["src/utils/*"],
      "@constants/*": ["src/constants/*"],
      "@types/*": ["src/types/*"],
      "@hooks/*": ["src/hooks/*"],
      "@api/*": ["src/api/*"]
    }
  },
  "include": ["src/**/*", "App.tsx", "index.js"],
  "exclude": ["node_modules", "android", "ios"]
}
```

#### 4.3 Update `metro.config.js`

```javascript
const { getDefaultConfig, mergeConfig } = require('@react-native/metro-config');
const path = require('path');

// Get the monorepo root
const projectRoot = __dirname;
const workspaceRoot = path.resolve(projectRoot, '../..');

const defaultConfig = getDefaultConfig(__dirname);

const config = {
  watchFolders: [workspaceRoot],
  transformer: {
    getTransformOptions: async () => ({
      transform: {
        experimentalImportSupport: false,
        inlineRequires: true,
      },
    }),
  },
  resolver: {
    sourceExts: ['jsx', 'js', 'ts', 'tsx', 'json'],
    nodeModulesPaths: [
      path.resolve(projectRoot, 'node_modules'),
      path.resolve(workspaceRoot, 'node_modules'),
    ],
  },
};

module.exports = mergeConfig(defaultConfig, config);
```

#### 4.4 Create `.env.example`

```bash
# Copy from mobile-old
cp ../mobile-old-0.73-backup/.env.example ./.env.example

# Create actual .env file
cp .env.example .env
```

#### 4.5 Update `app.json`

```json
{
  "name": "GTSD",
  "displayName": "GTSD",
  "scheme": "gtsd"
}
```

### Phase 5: Copy Source Code

```bash
# From apps/mobile directory
cd /Users/devarisbrown/Code/projects/gtsd/apps/mobile

# Remove generated src if it exists
rm -rf src

# Copy entire src directory from mobile-old
cp -R ../mobile-old-0.73-backup/src ./src

# Copy App.tsx (overwrite generated one)
cp ../mobile-old-0.73-backup/App.tsx ./App.tsx

# Copy index.js if customized
cp ../mobile-old-0.73-backup/index.js ./index.js

# Copy config files
cp ../mobile-old-0.73-backup/.eslintrc.js ./.eslintrc.js
cp ../mobile-old-0.73-backup/.prettierrc ./.prettierrc
cp ../mobile-old-0.73-backup/jest.config.js ./jest.config.js
cp ../mobile-old-0.73-backup/jest.setup.js ./jest.setup.js 2>/dev/null || true

# Copy .env files (if not already done)
cp ../mobile-old-0.73-backup/.env.example ./.env.example
cp ../mobile-old-0.73-backup/.env ./.env 2>/dev/null || true
```

### Phase 6: Configure Native Modules

#### 6.1 iOS Setup - React Native Config

**Edit `ios/mobile/AppDelegate.mm`** (add at top):

```objc
#import "RNCConfig.h"

// In didFinishLaunchingWithOptions, before the return
NSString *apiUrl = [RNCConfig envFor:@"REACT_APP_API_URL"];
```

**Edit `ios/Podfile`** (add before `use_react_native!`):

```ruby
# React Native Config
pod 'react-native-config', :path => '../node_modules/react-native-config'
```

**Configure .env for iOS:**
Create `ios/.xcode.env.local`:

```bash
export ENVFILE=../.env
```

#### 6.2 Android Setup - React Native Config

**Edit `android/app/build.gradle`** (add at top):

```gradle
apply from: project(':react-native-config').projectDir.getPath() + "/dotenv.gradle"
```

**Edit `android/settings.gradle`** (should be auto-linked):

```gradle
include ':react-native-config'
project(':react-native-config').projectDir = new File(rootProject.projectDir, '../node_modules/react-native-config/android')
```

#### 6.3 Auto-linking Check

```bash
# Navigate to iOS directory
cd ios

# Install pods (this will auto-link most native modules)
pod install

# Check for issues
pod install --verbose
```

### Phase 7: Fix Potential RN 0.76 Breaking Changes

#### 7.1 React Navigation v7 Updates

**Update navigation imports** if needed:

```typescript
// Old (v6)
import { NavigationContainer } from '@react-navigation/native';

// New (v7) - same, but check for prop changes
import { NavigationContainer } from '@react-navigation/native';
```

Check the React Navigation 7.x migration guide for any breaking changes in your navigation setup.

#### 7.2 Reanimated v3 Changes

If using Reanimated v4 APIs in mobile-old, downgrade to v3 compatible:

```typescript
// v4 API
import { useAnimatedStyle, withTiming } from 'react-native-reanimated';

// v3 API (compatible)
// Check if any worklets or shared values need updating
```

#### 7.3 AsyncStorage v2 Updates

AsyncStorage v2 has minor API changes - verify in stores:

```typescript
// Should work the same, but verify
import AsyncStorage from '@react-native-async-storage/async-storage';
```

### Phase 8: Verify Installation

```bash
# From apps/mobile directory

# TypeScript check
pnpm typecheck

# Run Metro bundler
pnpm start

# In separate terminal - iOS
pnpm ios

# In separate terminal - Android
pnpm android
```

---

## Part 4: Risk Assessment

### High Risk Issues

#### 1. React Navigation v6 ‚Üí v7 Breaking Changes

**Risk Level**: üî¥ HIGH
**Impact**: Navigation might break
**Mitigation**:

- Review [React Navigation 7.x changelog](https://reactnavigation.org/docs/upgrading-from-6.x)
- Test all navigation flows
- Check for deprecated props in `RootNavigator.tsx`

**Specific risks:**

- `headerLargeTitle` might be iOS-only or renamed
- Stack navigation props might have changed
- Deep linking config format might need updates

#### 2. Reanimated v4 ‚Üí v3 Downgrade

**Risk Level**: üü° MEDIUM
**Impact**: Animations might not work
**Mitigation**:

- Check if mobile-old uses Reanimated v4-specific APIs
- Search codebase for: `useSharedValue`, `useAnimatedStyle`, `withTiming`
- Test animations on both platforms

**Files to check:**

- `src/components/ConfettiAnimation.tsx`
- `src/components/StreakBar.tsx`

#### 3. pnpm Symlinks with CocoaPods

**Risk Level**: üü° MEDIUM
**Impact**: iOS builds might fail with "pathname contains null byte"
**Mitigation**:

- Use Podfile post_install script from mobile (0.76) version
- Add symlink filtering in Podfile
- Test pod install multiple times

#### 4. Native Module Autolinking

**Risk Level**: üü¢ LOW
**Impact**: Some native modules might not link
**Mitigation**:

- RN 0.76 has improved autolinking
- Verify each module: `react-native-keychain`, `react-native-config`, `react-native-image-picker`
- Run `npx react-native doctor` to verify

### Medium Risk Issues

#### 5. TypeScript Path Aliases

**Risk Level**: üü¢ LOW
**Impact**: Import errors
**Mitigation**:

- Ensure babel-plugin-module-resolver is configured
- Match tsconfig paths with babel aliases
- Run typecheck before testing

#### 6. Environment Variables (react-native-config)

**Risk Level**: üü° MEDIUM
**Impact**: API URL might not load
**Mitigation**:

- Verify .env file is copied
- Test both iOS and Android env loading
- Check AppDelegate.mm has RNCConfig import

### Low Risk Issues

#### 7. Jest Configuration

**Risk Level**: üü¢ LOW
**Impact**: Tests might not run
**Mitigation**:

- Update transformIgnorePatterns for RN 0.76
- Verify @react-native/metro-config version

#### 8. Metro Bundler Cache

**Risk Level**: üü¢ LOW
**Impact**: Stale cache issues
**Mitigation**:

```bash
pnpm start --reset-cache
```

---

## Part 5: Testing Strategy

### Checkpoint 1: Project Initialization ‚úì

**Goal**: Verify fresh RN 0.76 project builds

```bash
# iOS
cd ios && pod install && cd ..
pnpm ios

# Android
pnpm android
```

**Success Criteria**:

- ‚úÖ Default "Welcome to React Native" screen shows
- ‚úÖ No build errors
- ‚úÖ Hot reload works

---

### Checkpoint 2: Dependencies Installed ‚úì

**Goal**: All packages installed without conflicts

```bash
pnpm install
pnpm typecheck
```

**Success Criteria**:

- ‚úÖ No pnpm install errors
- ‚úÖ No peer dependency warnings (or acceptable ones documented)
- ‚úÖ TypeScript compiles without errors

---

### Checkpoint 3: Source Code Migrated ‚úì

**Goal**: Code compiles and bundles

```bash
pnpm typecheck
pnpm start --reset-cache
```

**Success Criteria**:

- ‚úÖ No TypeScript errors
- ‚úÖ Metro bundler starts without errors
- ‚úÖ Bundle builds successfully

---

### Checkpoint 4: Native Modules Linked ‚úì

**Goal**: All native dependencies work

**Test each module:**

```typescript
// Test react-native-config
import Config from 'react-native-config';
console.log('API URL:', Config.REACT_APP_API_URL);

// Test AsyncStorage
import AsyncStorage from '@react-native-async-storage/async-storage';
await AsyncStorage.setItem('test', 'value');

// Test Keychain
import * as Keychain from 'react-native-keychain';
await Keychain.setGenericPassword('username', 'password');

// Test NetInfo
import NetInfo from '@react-native-community/netinfo';
const state = await NetInfo.fetch();

// Test Haptic Feedback
import ReactNativeHapticFeedback from 'react-native-haptic-feedback';
ReactNativeHapticFeedback.trigger('impactLight');
```

**Success Criteria**:

- ‚úÖ No native module errors
- ‚úÖ Config loads .env values correctly
- ‚úÖ Keychain saves/retrieves values
- ‚úÖ NetInfo detects connection

---

### Checkpoint 5: Backend Down - Auth Resilience ‚úì

**Goal**: App doesn't hang when backend is unreachable

**Test:**

1. Ensure API backend is NOT running
2. Kill and restart the app
3. Time how long until Welcome screen shows

```bash
# Stop API backend
# (Do not start it)

# Restart app
# Kill app on device/simulator
pnpm ios  # or pnpm android
```

**Success Criteria**:

- ‚úÖ Welcome screen appears within 5 seconds
- ‚úÖ No infinite loading spinners
- ‚úÖ Console shows "Auth check timeout after 5s" or similar
- ‚úÖ App remains usable (can see Welcome screen)

**Critical Code to Verify:**

```typescript
// src/stores/authStore.ts lines 195-197
const timeoutPromise = new Promise<never>((_, reject) =>
  setTimeout(() => reject(new Error('Auth check timeout after 5s')), 5000)
);
```

```typescript
// src/navigation/RootNavigator.tsx lines 64-79
// Non-blocking hydration
try {
  await checkAuthStatus();
} catch (error) {
  console.error('Auth check failed during init:', error);
  // Continue anyway
} finally {
  setIsHydrated(true);
}
```

---

### Checkpoint 6: Backend Up - Full Auth Flow ‚úì

**Goal**: Login, signup, and session management work

**Test:**

1. Start API backend
2. Test signup flow
3. Test login flow
4. Test session persistence
5. Test logout

```bash
# Start API backend
cd /Users/devarisbrown/Code/projects/gtsd/apps/api
pnpm dev
```

**In the app:**

1. Open Welcome screen
2. Click "Sign Up"
3. Fill form and submit
4. Verify redirect to onboarding
5. Complete onboarding
6. Verify redirect to Today screen
7. Kill and restart app
8. Verify auto-login works
9. Logout
10. Verify redirect to Welcome

**Success Criteria**:

- ‚úÖ Signup creates account and logs in
- ‚úÖ Login authenticates successfully
- ‚úÖ Session persists across app restarts
- ‚úÖ Logout clears session
- ‚úÖ Token refresh works (test after token expiry)
- ‚úÖ API errors display properly

---

### Checkpoint 7: Navigation & Deep Links ‚úì

**Goal**: All screens accessible, deep links work

**Test:**

1. Navigate to all onboarding screens
2. Navigate to Today screen
3. Navigate to Badges screen
4. Test deep link: `gtsd://today`
5. Test deep link: `gtsd://task/123`

```bash
# iOS deep link test
xcrun simctl openurl booted "gtsd://today"

# Android deep link test
adb shell am start -W -a android.intent.action.VIEW -d "gtsd://today"
```

**Success Criteria**:

- ‚úÖ All screens render without errors
- ‚úÖ Navigation transitions work
- ‚úÖ Back button works correctly
- ‚úÖ Deep links open correct screens
- ‚úÖ Deep link params parsed correctly

---

### Checkpoint 8: State Management ‚úì

**Goal**: Zustand stores work with persistence

**Test each store:**

```typescript
// Auth store
const { login, logout, user } = useAuthStore();

// Today store (if exists)
const { tasks, fetchTasks } = useTodayStore();

// Streaks store
const { currentStreak, fetchStreak } = useStreaksStore();
```

**Actions to test:**

1. Login ‚Üí verify user in store
2. Kill app ‚Üí restart ‚Üí verify user persisted
3. Logout ‚Üí verify user cleared
4. Fetch tasks ‚Üí verify state updates
5. Update task ‚Üí verify state updates

**Success Criteria**:

- ‚úÖ All stores initialize correctly
- ‚úÖ State persists to AsyncStorage
- ‚úÖ State hydrates on app start
- ‚úÖ Actions update state correctly
- ‚úÖ No hydration race conditions

---

### Checkpoint 9: Full Integration Test

**Goal**: Complete user flow works end-to-end

**Test scenario:**

1. Fresh install (clear app data)
2. Open app ‚Üí see Welcome
3. Sign up with new account
4. Complete onboarding flow
5. View Today screen
6. Complete a task
7. View streak
8. Upload photo evidence
9. Kill app ‚Üí restart
10. Verify logged in and data persists

**Success Criteria**:

- ‚úÖ Complete flow works without errors
- ‚úÖ Data persists correctly
- ‚úÖ UI responds appropriately
- ‚úÖ No console errors
- ‚úÖ Performance is acceptable

---

## Part 6: Rollback Plan

If migration fails critically, here's how to rollback:

### Option 1: Restore mobile-old (Quick Fix iOS)

If the only issue is missing `project.pbxproj`:

```bash
# Try regenerating iOS project
cd /Users/devarisbrown/Code/projects/gtsd/apps/mobile-old-0.73-backup
rm -rf ios
npx react-native-community/cli init TempProject --version 0.73.2
cp -R TempProject/ios ./ios

# Update project name in Xcode
# Open ios/GTSD.xcworkspace
# Rename project to GTSD
```

### Option 2: Use mobile (0.76) and fix pnpm issues

If CocoaPods is the main problem:

```bash
# Try using npm instead of pnpm (temporary)
cd /Users/devarisbrown/Code/projects/gtsd/apps/mobile-broken-0.76-backup
rm -rf node_modules
npm install
cd ios && pod install
```

### Option 3: Hybrid Approach

Use mobile-old code with fresh native layer from new migration.

---

## Part 7: Post-Migration Tasks

### 1. Update Documentation

```bash
# Update README
# Document new setup process
# Update environment variable instructions
```

### 2. Configure CI/CD (if applicable)

```yaml
# .github/workflows/mobile.yml
# Update to RN 0.76
# Update test commands
```

### 3. Team Communication

- Notify team of new setup requirements
- Document any new native dependencies
- Share updated .env.example

### 4. Clean Up

```bash
# After successful migration and 1 week of stability
rm -rf /Users/devarisbrown/Code/projects/gtsd/apps/mobile-old-0.73-backup
rm -rf /Users/devarisbrown/Code/projects/gtsd/apps/mobile-broken-0.76-backup
```

---

## Appendix A: Key Files Reference

### Files to Copy from mobile-old

```
‚úÖ src/                    (entire directory)
‚úÖ App.tsx
‚úÖ .env.example
‚úÖ .eslintrc.js
‚úÖ .prettierrc
‚úÖ jest.config.js
‚úÖ jest.setup.js
```

### Files to Modify in Fresh Project

```
üìù package.json            (add dependencies)
üìù babel.config.js         (add aliases + reanimated)
üìù tsconfig.json           (add path mappings)
üìù metro.config.js         (monorepo config)
üìù app.json                (scheme + display name)
üìù ios/Podfile             (pnpm symlink fixes)
üìù android/app/build.gradle (react-native-config)
```

### Files Generated by RN CLI (Don't Copy)

```
‚ùå ios/                    (fresh generation)
‚ùå android/                (fresh generation)
‚ùå node_modules/
‚ùå package-lock.json
```

---

## Appendix B: Common Issues & Solutions

### Issue 1: "pathname contains null byte"

**Cause**: pnpm symlinks in CocoaPods
**Solution**: Use Podfile post_install script from Part 3, Phase 6.1

### Issue 2: Metro bundler can't resolve @gtsd/shared-types

**Cause**: Monorepo workspace not configured
**Solution**: Update metro.config.js with watchFolders

### Issue 3: React Native Config not loading .env

**Cause**: Missing native configuration
**Solution**: Follow Part 3, Phase 6 for iOS/Android setup

### Issue 4: TypeScript can't find path aliases

**Cause**: Mismatch between tsconfig and babel config
**Solution**: Ensure both files have same alias mappings

### Issue 5: App hangs on splash screen

**Cause**: Zustand hydration blocking render
**Solution**: Verify non-blocking hydration in RootNavigator.tsx

---

## Appendix C: Dependency Version Matrix

| Dependency       | RN 0.73 | RN 0.76 | Breaking?              |
| ---------------- | ------- | ------- | ---------------------- |
| React            | 18.2.0  | 18.3.1  | No                     |
| React Navigation | 6.x     | 7.x     | Yes - check docs       |
| Reanimated       | 4.x     | 3.16.x  | Yes - downgrade needed |
| AsyncStorage     | 1.x     | 2.x     | Minor changes          |
| Zustand          | 4.x     | 4.x     | No                     |
| React Query      | 5.x     | 5.x     | No                     |
| Axios            | 1.x     | 1.x     | No                     |

---

## Execution Timeline Estimate

| Phase                             | Estimated Time | Critical Path? |
| --------------------------------- | -------------- | -------------- |
| Phase 1: Create fresh project     | 15 min         | Yes            |
| Phase 2: Configure monorepo       | 10 min         | Yes            |
| Phase 3: Add dependencies         | 20 min         | Yes            |
| Phase 4: Configure build tools    | 30 min         | Yes            |
| Phase 5: Copy source code         | 10 min         | Yes            |
| Phase 6: Configure native modules | 45 min         | Yes            |
| Phase 7: Fix breaking changes     | 1-3 hours      | Yes            |
| Phase 8: Verify installation      | 30 min         | Yes            |
| Testing (all checkpoints)         | 2-4 hours      | Yes            |
| **Total**                         | **5-8 hours**  |                |

**Recommended approach**: Block out a full day for migration and testing.

---

## Next Steps

1. ‚úÖ Review this plan with team
2. ‚úÖ Backup current projects (already renamed with -backup suffix)
3. ‚úÖ Schedule migration window (recommend full day)
4. ‚úÖ Begin Phase 1: Create Fresh Project
5. ‚úÖ Follow checkpoints sequentially
6. ‚úÖ Document any issues encountered
7. ‚úÖ Update this plan with lessons learned

---

## Questions to Address Before Starting

1. **Do we have all API endpoints working?** (for Checkpoint 6)
2. **Do we have test accounts for signup/login?**
3. **Are there any production builds we need to maintain during migration?**
4. **Should we create a migration branch first?**

---

**Document Version**: 1.0
**Last Updated**: 2025-10-26
**Author**: Claude (Senior Code Reviewer)
**Next Review**: After successful migration
